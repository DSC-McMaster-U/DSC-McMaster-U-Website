import{visit as e}from"graphql/language/visitor";import{Kind as t}from"graphql/language/kinds";import{print as r}from"graphql/language/printer";import{parse as n}from"graphql/language/parser";import{share as o,onPush as i,takeWhile as u,toPromise as c,take as f,filter as p,map as h,tap as l,merge as y,mergeMap as d,takeUntil as v,make as k,switchMap as x,fromValue as g,interval as q,makeSubject as O,publish as b,onStart as w,onEnd as E,subscribe as N}from"wonka";import{s as _,_ as S,C as P,m as R,a as j,b as Q,c as L,d as D,e as M}from"./2a3ec8aa.min.mjs";export{C as CombinedError,a as makeErrorResult,m as makeResult,s as stringifyVariables}from"./2a3ec8aa.min.mjs";function A(e,t){e|=0;for(var r=0,n=0|t.length;r<n;r++)e=(e<<5)+e+t.charCodeAt(r);return e}function T(e){return A(5381,e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim())>>>0}var $=Object.create(null);function I(e,t){if("string"==typeof e){var o=T(e);e=void 0!==$[o]?$[o]:n(e,{noLocation:!0})}else void 0!==e.__key?o=e.__key:(o=T(r(e)),e=void 0!==$[o]?$[o]:e);return $[o]=e,e.__key=o,{key:t?A(o,_(t))>>>0:o,query:e,variables:t||{}}}function F(e,t){return S({},e,{context:S({},e.context,{meta:S({},e.context.meta,t)})})}function G(e,t){if(void 0===t&&(t=[]),Array.isArray(e))e.forEach((function(e){G(e,t)}));else if("object"==typeof e&&null!==e)for(var r in e)"__typename"===r&&"string"==typeof e[r]?t.push(e[r]):G(e[r],t);return t}function J(e,t,r){return r.indexOf(e)===t}function V(e){return e.kind===t.FIELD&&"__typename"===e.name.value}function z(e){if(e.selectionSet&&!e.selectionSet.selections.some(V))return S({},e,{selectionSet:S({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:t.FIELD,name:{kind:t.NAME,value:"__typename"}}])})})}function B(t){var r=e(t,{Field:z,InlineFragment:z});return r.__key=t.__key,r}function H(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,r){var n=e[r];return"__typename"===r?Object.defineProperty(t,"__typename",{enumerable:!1,value:n}):t[r]=Array.isArray(n)?n.map(H):n&&"object"==typeof n&&"__typename"in n?H(n):n,t}),{}):e}function K(e){return e.toPromise=function(){return c(f(1)(e))},e}function U(){}function W(e){return"subscription"!==(e=e.operationName)&&"query"!==e}function X(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function Y(e){return"mutation"!==(e=e.operationName)&&"query"!==e}function Z(e){return S({},e,{query:B(e.query)})}function ee(e){return"query"!==e.operationName||"cache-only"!==e.context.requestPolicy}function te(e){return F(e,{cacheOutcome:"miss"})}function re(e){return Y(e)}function ne(e){function t(e){var t=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==t&&("cache-only"===t||s.has(e.key))}function r(e){var t=s.get(e.key);return t=S({},t,{operation:F(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,oe(c,e)),t}function n(e){return!Y(e)&&t(e)}function i(e){e.operation&&"mutation"===e.operation.operationName?f(e):e.operation&&"query"===e.operation.operationName&&m(e)}function a(e){return!Y(e)&&!t(e)}var u=e.forward,c=e.client,s=new Map;e=Object.create(null);var f=function(e,t,r){function n(t){if(e.has(t)){var n=e.get(t).operation;e.delete(t),oe(r,n)}}return function(e){function r(e){o.add(e)}var o=new Set,i=e.operation.context.additionalTypenames;G(e.data).filter(J).concat(i||[]).forEach((function(e){(e=t[e]||(t[e]=new Set)).forEach(r),e.clear()})),o.forEach(n)}}(s,e,c),m=function(e,t){return function(r){var n=r.operation,o=r.data,i=n.context.additionalTypenames;null!=o&&(e.set(n.key,{operation:n,data:o,error:r.error}),G(r.data).filter(J).concat(i||[]).forEach((function(e){(t[e]||(t[e]=new Set)).add(n.key)})))}}(s,e);return function(e){var t=o(e);return e=h(r)(p(n)(t)),t=l(i)(u(p(ee)(h(te)(y([h(Z)(p(a)(t)),p(re)(t)]))))),y([e,t])}}function oe(e,t){return e.reexecuteOperation(S({},t,{context:S({},t.context,{requestPolicy:"network-only"})}))}function ie(e){function t(e){o.delete(e.operation.key)}function r(e){var t=e.key;return"teardown"===(e=e.operationName)?(o.delete(t),!0):"query"!==e&&"subscription"!==e||(e=o.has(t),o.add(t),!e)}var n=e.forward,o=new Set;return function(e){return e=p(r)(e),l(t)(n(e))}}function ae(e){return"query"===e.operationName||"mutation"===e.operationName}function ue(e){return"query"!==e.operationName&&"mutation"!==e.operationName}function ce(e){var t=e.forward;return function(e){var r=o(e);e=d((function(e){var t=e.key,n=p((function(e){return"teardown"===e.operationName&&e.key===t}))(r),o=Q(e),a=L(e,o);return o=D(e,o),i((function(){}))(v(n)(M(e,a,o)))}))(p(ae)(r));var n=t(p(ue)(r));return y([e,n])}}function se(){return!1}function fe(){function e(){}return function(t){return p(se)(l(e)(t))}}var pe=fe();function he(e){return function(t){var r=t.client;return e.reduceRight((function(e,t){return t({client:r,forward:e,dispatchDebug:function(){}})}),t.forward)}}var le=[ie,ne,ce];function ye(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return S({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{requestPolicy:(e||{}).requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.executeQuery=function(e,r){e=t.createRequestOperation("query",e,r);var n=t.executeRequestOperation(e);return(e=e.context.pollInterval)?x((function(){return n}))(y([g(0),q(e)])):n},this.executeSubscription=function(e,r){return e=t.createRequestOperation("subscription",e,r),t.executeRequestOperation(e)},this.executeMutation=function(e,r){return e=t.createRequestOperation("mutation",e,r),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var r=O(),n=r.next;this.operations$=r.source;var i=!1;this.dispatchOperation=function(e){for(i=!0,e&&n(e);e=t.queue.shift();)n(e);i=!1},this.reexecuteOperation=function(e){("mutation"===e.operationName||0<(t.activeOperations[e.key]||0))&&(t.queue.push(e),i||Promise.resolve().then(t.dispatchOperation))},e=he(void 0!==e.exchanges?e.exchanges:le),this.results$=o(e({client:this,dispatchDebug:U,forward:fe()})(this.operations$)),b(this.results$)}function me(e){return e.data=H(e.data),e}function de(e){return new ye(e)}function ve(e){var t=e.forward;return function(e){return t(e)}}function ke(e){function t(e){var t=e.error;e=e.operation,t&&r(t,e)}var r=e.onError;return function(e){var r=e.forward;return function(e){return l(t)(r(e))}}}function xe(e){function t(t){var r=t.client,i=t.forward;return function(t){var f=e&&"boolean"==typeof e.isClient?!!e.isClient:!r.suspense,m=o(t);return t=i(p(a)(m)),m=h(u)(p(c)(m)),f?m=l(n)(m):t=l(s)(t),y([t,m])}}function r(e){return!W(e)&&void 0!==f[e.key]}function n(e){m.push(e.operation.key),1===m.length&&Promise.resolve().then(i)}function i(){for(var e;e=m.shift();)delete f[e]}function a(e){return!r(e)}function u(e){var t=f[e.key],r=t.error;return{operation:e,data:(t=t.data)?JSON.parse(t):void 0,extensions:void 0,error:r?new P({networkError:r.networkError?Error(r.networkError):void 0,graphQLErrors:r.graphQLErrors&&r.graphQLErrors.length?r.graphQLErrors:void 0}):void 0}}function c(e){return r(e)}function s(e){var t=e.operation;if(!W(t)){var r=e.error;e={data:JSON.stringify(e.data),error:void 0},r&&(e.error={graphQLErrors:r.graphQLErrors.map(X),networkError:r.networkError?""+r.networkError:void 0}),f[t.key]=e}}var f={},m=[];return t.restoreData=function(e){return S(f,e)},t.extractData=function(){return S({},f)},e&&e.initialState&&t.restoreData(e.initialState),t}function ge(e){function t(e){return"subscription"===(e=e.operationName)||!!i&&("query"===e||"mutation"===e)}var n=e.forwardSubscription,i=e.enableAllOperations;return function(e){function i(e){var t=n({key:e.key.toString(36),query:r(e.query),variables:e.variables,context:S({},e.context)});return k((function(r){function n(t){return c(R(e,t))}function o(t){return c(j(e,t))}function i(){f||(f=!0,"subscription"===e.operationName&&u.reexecuteOperation(S({},e,{operationName:"teardown"})),s())}var a,c=r.next,s=r.complete,f=!1;return Promise.resolve().then((function(){f||(a=t.subscribe({next:n,error:o,complete:i}))})),function(){f=!0,a&&a.unsubscribe()}}))}function a(e){return!s(e)}var u=e.client,c=e.forward,s=t;return function(e){var t=o(e);e=d((function(e){var r=e.key,n=p((function(e){return"teardown"===e.operationName&&e.key===r}))(t);return v(n)(i(e))}))(p(s)(t));var r=c(p(a)(t));return y([e,r])}}}ye.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},ye.prototype.onOperationEnd=function(e){var t=e.key,r=this.activeOperations[t]||0;0>=(this.activeOperations[t]=0>=r?0:r-1)&&this.dispatchOperation(S({},e,{operationName:"teardown"}))},ye.prototype.executeRequestOperation=function(e){var t=this,r=e.key,n=e.operationName,a=p((function(e){return e.operation.key===r}))(this.results$);if(this.maskTypename&&(a=h(me)(a)),"mutation"===n)return f(1)(w((function(){return t.dispatchOperation(e)}))(a));var s=p((function(e){return"teardown"===e.operationName&&e.key===r}))(this.operations$);return a=E((function(){t.onOperationEnd(e)}))(w((function(){t.onOperationStart(e)}))(v(s)(a))),!1!==e.context.suspense&&this.suspense&&"query"===n?function(e){return function(t){var r=o(e),n=!1,a=!1;if(i((function(){return n=!0}))(u((function(){return!a}))(r))(t),!n)throw a=!0,t(0),c(f(1)(r))}}(a):a},ye.prototype.query=function(e,t,r){return r&&"boolean"==typeof r.suspense||(r=S({},r,{suspense:!1})),K(this.executeQuery(I(e,t),r))},ye.prototype.readQuery=function(e,t,r){var n=null;return N((function(e){n=e}))(this.executeQuery(I(e,t),r)).unsubscribe(),n},ye.prototype.subscription=function(e,t,r){return this.executeSubscription(I(e,t),r)},ye.prototype.mutation=function(e,t,r){return K(this.executeMutation(I(e,t),r))};export{ye as Client,ne as cacheExchange,he as composeExchanges,de as createClient,I as createRequest,ve as debugExchange,ie as dedupExchange,le as defaultExchanges,ke as errorExchange,pe as fallbackExchangeIO,ce as fetchExchange,B as formatDocument,H as maskTypename,xe as ssrExchange,ge as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
