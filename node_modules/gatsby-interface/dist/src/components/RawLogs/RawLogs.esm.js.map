{"version":3,"file":"RawLogs.esm.js","sources":["../../../../src/components/RawLogs/RawLogs.tsx"],"sourcesContent":["/** @jsx jsx */\nimport { jsx } from \"@emotion/core\"\nimport React from \"react\"\nimport format from \"date-fns/format\"\nimport { ThemeCss } from \"../../theme\"\n\nconst baseCss: ThemeCss = theme => ({\n  padding: theme.space[7],\n  backgroundColor: theme.colors.grey[90],\n  color: theme.colors.white,\n  fontFamily: theme.fonts.monospace,\n  fontSize: theme.fontSizes[1],\n  lineHeight: theme.lineHeights.default,\n})\n\nconst listCss: ThemeCss = _theme => ({\n  listStyle: `none`,\n  margin: 0,\n  padding: 0,\n  height: `100%`,\n  overflowY: `auto`,\n})\n\nexport type RawLogItem = {\n  id?: string | null\n  message?: string | null\n  timestamp?: number | string\n  sourceStream?: \"STDERR\" | \"STDOUT\" | null\n  [k: string]: unknown\n}\n\nexport type RawLogsProps = {\n  logItems: RawLogItem[]\n  // require aria-label for a11y\n  \"aria-label\": string\n  timeFormat?: string\n  className?: string\n}\n\nexport function RawLogs({\n  logItems,\n  \"aria-label\": ariaLabel,\n  timeFormat = \"HH:mm:ss aa:\",\n  className,\n}: RawLogsProps) {\n  const listRef = React.useRef<HTMLOListElement>(null)\n  const [autoScroll, setAutoScroll] = React.useState<boolean>(false)\n\n  React.useEffect(() => {\n    if (!autoScroll || !listRef.current) {\n      return\n    }\n\n    if (listRef.current.scrollHeight > listRef.current.clientHeight) {\n      listRef.current.scrollTop = listRef.current.scrollHeight\n    } else {\n      ;(listRef.current.lastChild as HTMLLIElement).scrollIntoView()\n    }\n  })\n\n  const handleScroll = (e: React.UIEvent<HTMLOListElement>) => {\n    const list = e.target as HTMLOListElement\n    const isAtEnd = list.scrollHeight - list.scrollTop === list.clientHeight\n\n    if (isAtEnd) {\n      setAutoScroll(true)\n    } else if (autoScroll && !isAtEnd) {\n      setAutoScroll(false)\n    }\n  }\n\n  return (\n    <div role=\"log\" css={baseCss} className={className}>\n      <ol\n        tabIndex={0}\n        ref={listRef}\n        aria-label={ariaLabel}\n        css={listCss}\n        onScroll={handleScroll}\n      >\n        {logItems.map(({ id, timestamp, message, sourceStream }, idx) => {\n          let key: React.Key = idx\n\n          if (id) {\n            key = id\n          } else if (message && timestamp) {\n            key = `${message}--${timestamp}`\n          }\n\n          const timestampDate = timestamp ? new Date(timestamp) : null\n\n          const itemCss: ThemeCss = theme => ({\n            margin: 0,\n            color:\n              sourceStream === \"STDERR\"\n                ? theme.colors.red[40]\n                : theme.colors.white,\n          })\n\n          return (\n            <li key={key} css={itemCss}>\n              {timestampDate && (\n                <time dateTime={timestampDate.toString()}>\n                  {format(timestampDate, timeFormat)}\n                </time>\n              )}\n              &nbsp;\n              {message}\n            </li>\n          )\n        })}\n      </ol>\n    </div>\n  )\n}\n"],"names":["baseCss","theme","padding","space","backgroundColor","colors","grey","color","white","fontFamily","fonts","monospace","fontSize","fontSizes","lineHeight","lineHeights","listCss","_theme","listStyle","margin","height","overflowY","RawLogs","logItems","ariaLabel","timeFormat","className","listRef","React","useRef","useState","autoScroll","setAutoScroll","useEffect","current","scrollHeight","clientHeight","scrollTop","lastChild","scrollIntoView","handleScroll","e","list","target","isAtEnd","map","idx","id","timestamp","message","sourceStream","key","timestampDate","Date","itemCss","red","toString","format"],"mappings":"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"}