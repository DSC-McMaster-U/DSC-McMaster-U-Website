{"version":3,"file":"BuildActivityEntry.esm.js","sources":["../../../../src/components/BuildLogs/BuildActivityEntry.tsx"],"sourcesContent":["/** @jsx jsx */\nimport { jsx } from \"@emotion/core\"\nimport React from \"react\"\nimport {\n  BuildLogItem,\n  BuildActivity,\n  BuildActivityStatus,\n  BuildActivityType,\n} from \"./types\"\nimport { ProgressBar } from \"../ProgressBar\"\nimport { MdCheck, MdClose } from \"react-icons/md\"\nimport { InProgressIcon, IconProps } from \"../icons\"\nimport { ThemeCss, Theme } from \"../../theme\"\nimport { BuildLogEntrySkeleton } from \"./BuildLogEntrySkeleton\"\n\nconst durationCellCss: ThemeCss = theme => ({\n  display: `grid`,\n  alignItems: `center`,\n  fontSize: theme.fontSizes[1],\n  [theme.mediaQueries.tablet]: {\n    gridTemplateColumns: `50% 50%`,\n  },\n})\n\nconst durationCss: ThemeCss = theme => ({\n  textAlign: `end`,\n  fontSize: theme.fontSizes[0],\n})\n\nconst hiddenOnMobileCss: ThemeCss = theme => ({\n  display: `none`,\n  padding: `0 ${theme.space[4]}`,\n  [theme.mediaQueries.tablet]: {\n    display: `block`,\n  },\n})\n\nconst statusColorLookup = (\n  theme: Theme\n): Record<BuildActivityStatus, string> => ({\n  [BuildActivityStatus.Failed]: theme.colors.red[70],\n  [BuildActivityStatus.InProgress]: theme.colors.blue[80],\n  [BuildActivityStatus.NotStarted]: theme.colors.grey[50],\n  [BuildActivityStatus.Success]: theme.colors.grey[50],\n  [BuildActivityStatus.Interrupted]: theme.colors.red[70],\n})\n\nexport type BuildActivityEntryProps = Omit<BuildLogItem, \"activity\"> & {\n  // Require \"activity\"\n  activity: BuildActivity\n}\n\nexport function BuildActivityEntry({\n  activity,\n  ...standardLogData\n}: BuildActivityEntryProps) {\n  const { duration, current, total, type, status } = activity\n\n  const isSuccessfulActivity = status === BuildActivityStatus.Success\n  const isFailedActivity = [\n    BuildActivityStatus.Interrupted,\n    BuildActivityStatus.Failed,\n  ].includes(status)\n\n  /*\n   * Normalize total in case it's not updated properly when activity succeeds\n   */\n  const normalizedTotal = isSuccessfulActivity ? current : total\n\n  const showProgressBar =\n    type === BuildActivityType.Progress &&\n    !isSuccessfulActivity &&\n    !isFailedActivity\n\n  const baseCss: ThemeCss = theme => ({\n    color: statusColorLookup(theme)[status],\n  })\n\n  const progressCss: ThemeCss = theme => [\n    hiddenOnMobileCss(theme),\n    {\n      textAlign: `right`,\n      fontSize: theme.fontSizes[0],\n      visibility: isFailedActivity ? `hidden` : `visible`,\n    },\n  ]\n\n  return (\n    <BuildLogEntrySkeleton\n      icon={<ActivityStatusIcon activityId={activity.id} status={status} />}\n      css={baseCss}\n    >\n      <div id={`activity__message--${activity.id}`}>\n        {activity.message || activity.name || standardLogData.message}\n      </div>\n      <div css={hiddenOnMobileCss}>\n        {showProgressBar && (\n          <ProgressBar\n            value={current || 0}\n            max={normalizedTotal || 0}\n            getProgressColor={theme => theme.colors.blue[50]}\n            aria-describedby={`activity__message--${activity.id}`}\n          />\n        )}\n      </div>\n      <div css={durationCellCss}>\n        <span css={progressCss}>\n          {formatProgress(current, normalizedTotal)}\n        </span>\n        {typeof duration === `number` && (\n          <span css={durationCss}>{formatDuration(duration)}</span>\n        )}\n      </div>\n    </BuildLogEntrySkeleton>\n  )\n}\n\nconst formatDuration = (duration: number) => `${duration.toFixed(2)}s`\n\nconst formatProgress = (\n  current: number | null | undefined,\n  total: number | null | undefined\n) =>\n  [\n    current,\n    typeof total === \"number\" && typeof current === \"number\" && total < current\n      ? current\n      : total,\n  ]\n    .filter(part => typeof part === `number`)\n    .join(` / `)\n\ntype ActivityStatusIconProps = {\n  activityId: string\n  status: BuildActivityStatus\n}\n\nfunction ActivityStatusIcon({ activityId, status }: ActivityStatusIconProps) {\n  const statusVariant = status ? activityEntryStatusVariants[status] : null\n\n  if (!statusVariant) {\n    return null\n  }\n\n  return (\n    <statusVariant.Icon\n      aria-label={statusVariant.label}\n      css={statusVariant.styles}\n      id={`statusIcon--${activityId}`}\n    />\n  )\n}\n\nconst activityEntryStatusVariants: Partial<Record<\n  BuildActivityStatus,\n  {\n    label: string\n    Icon: React.ComponentType<any>\n    styles: ThemeCss\n  }\n>> = {\n  [BuildActivityStatus.Success]: {\n    label: `Completed`,\n    Icon: MdCheck,\n    styles: theme => ({\n      color: theme.colors.grey[40],\n    }),\n  },\n  [BuildActivityStatus.Interrupted]: {\n    label: `Failed`,\n    Icon: MdClose,\n    styles: theme => ({\n      color: theme.colors.red[60],\n    }),\n  },\n  [BuildActivityStatus.Failed]: {\n    label: `Failed`,\n    Icon: MdClose,\n    styles: theme => ({\n      color: theme.colors.red[60],\n    }),\n  },\n  [BuildActivityStatus.InProgress]: {\n    label: `In Progress`,\n    Icon: ActivityInProgressIcon,\n    styles: theme => ({\n      color: theme.colors.blue[80],\n    }),\n  },\n}\n\nfunction ActivityInProgressIcon(props: IconProps) {\n  return <InProgressIcon {...props} size=\"inherit\" />\n}\n"],"names":["durationCellCss","theme","display","alignItems","fontSize","fontSizes","mediaQueries","tablet","gridTemplateColumns","durationCss","textAlign","hiddenOnMobileCss","padding","space","statusColorLookup","BuildActivityStatus","Failed","colors","red","InProgress","blue","NotStarted","grey","Success","Interrupted","BuildActivityEntry","activity","standardLogData","duration","current","total","type","status","isSuccessfulActivity","isFailedActivity","includes","normalizedTotal","showProgressBar","BuildActivityType","Progress","baseCss","color","progressCss","visibility","id","message","name","formatProgress","formatDuration","toFixed","filter","part","join","ActivityStatusIcon","activityId","statusVariant","activityEntryStatusVariants","label","styles","Icon","MdCheck","MdClose","ActivityInProgressIcon","props"],"mappings":"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"}